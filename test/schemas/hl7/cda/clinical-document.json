{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "HL7 CDA Clinical Document Architecture",
  "description": "HL7 CDA R2 Clinical Document with structured sections and entries",
  "type": "object",
  "x-cross-field-rules": [
    {
      "rule": "effectiveTime >= author.time",
      "description": "Document effective time must be after or equal to authoring time"
    },
    {
      "rule": "if confidentialityCode == 'R' then authorization must be present",
      "description": "Restricted documents must have authorization"
    }
  ],
  "required": ["realmCode", "typeId", "templateId", "id", "code", "title", "effectiveTime", "confidentialityCode", "languageCode", "recordTarget", "author", "custodian", "component"],
  "properties": {
    "realmCode": {
      "type": "object",
      "properties": {
        "code": {"type": "string", "const": "US"}
      }
    },
    "typeId": {
      "type": "object",
      "properties": {
        "root": {"type": "string", "const": "2.16.840.1.113883.1.3"},
        "extension": {"type": "string", "const": "POCD_HD000040"}
      }
    },
    "templateId": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "root": {
            "type": "string",
            "examples": [
              "2.16.840.1.113883.10.20.22.1.1",
              "2.16.840.1.113883.10.20.22.1.2",
              "2.16.840.1.113883.10.20.22.1.8",
              "2.16.840.1.113883.10.20.22.1.9"
            ]
          },
          "extension": {"type": "string"}
        }
      }
    },
    "id": {
      "type": "object",
      "required": ["root"],
      "properties": {
        "root": {
          "type": "string",
          "format": "uuid"
        },
        "extension": {"type": "string"}
      }
    },
    "code": {
      "type": "object",
      "required": ["code", "codeSystem", "displayName"],
      "properties": {
        "code": {
          "type": "string",
          "examples": ["11488-4", "18842-5", "28570-0", "34133-9", "51847-2"]
        },
        "codeSystem": {
          "type": "string",
          "const": "2.16.840.1.113883.6.1"
        },
        "codeSystemName": {"type": "string", "const": "LOINC"},
        "displayName": {
          "type": "string",
          "x-llm": true,
          "description": "llm: Generate appropriate document type name based on code"
        }
      }
    },
    "title": {
      "type": "string",
      "x-llm": true,
      "description": "llm: Generate realistic clinical document title"
    },
    "effectiveTime": {
      "type": "object",
      "required": ["value"],
      "properties": {
        "value": {
          "type": "string",
          "pattern": "^\\d{14}$",
          "description": "YYYYMMDDHHMMSS format"
        }
      }
    },
    "confidentialityCode": {
      "type": "object",
      "properties": {
        "code": {
          "type": "string",
          "enum": ["N", "R", "V"]
        },
        "codeSystem": {"type": "string", "const": "2.16.840.1.113883.5.25"},
        "displayName": {
          "type": "string",
          "enum": ["Normal", "Restricted", "Very Restricted"]
        }
      }
    },
    "languageCode": {
      "type": "object",
      "properties": {
        "code": {"type": "string", "default": "en-US"}
      }
    },
    "setId": {
      "type": "object",
      "properties": {
        "root": {"type": "string", "format": "uuid"}
      }
    },
    "versionNumber": {
      "type": "object",
      "properties": {
        "value": {"type": "integer", "minimum": 1}
      }
    },
    "recordTarget": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["patientRole"],
        "properties": {
          "patientRole": {
            "type": "object",
            "required": ["id", "patient"],
            "properties": {
              "id": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "root": {"type": "string"},
                    "extension": {
                      "type": "string",
                      "x-llm": true,
                      "description": "llm: Generate realistic medical record number"
                    },
                    "assigningAuthorityName": {
                      "type": "string",
                      "x-llm": true,
                      "description": "llm: Generate realistic assigning authority name"
                    }
                  }
                }
              },
              "addr": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "use": {"type": "string", "enum": ["H", "WP", "TMP", "BAD"]},
                    "streetAddressLine": {
                      "type": "string",
                      "x-llm": true,
                      "description": "llm: Generate realistic street address"
                    },
                    "city": {
                      "type": "string",
                      "x-llm": true,
                      "description": "llm: Generate realistic city name"
                    },
                    "state": {
                      "type": "string",
                      "pattern": "^[A-Z]{2}$"
                    },
                    "postalCode": {
                      "type": "string",
                      "pattern": "^\\d{5}(-\\d{4})?$"
                    },
                    "country": {"type": "string", "default": "US"}
                  }
                }
              },
              "telecom": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "use": {"type": "string", "enum": ["H", "WP", "MC"]},
                    "value": {
                      "type": "string",
                      "x-llm": true,
                      "description": "llm: Generate realistic contact information"
                    }
                  }
                }
              },
              "patient": {
                "type": "object",
                "required": ["name", "administrativeGenderCode", "birthTime"],
                "properties": {
                  "name": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "use": {"type": "string", "enum": ["L", "C", "P", "A", "R"]},
                        "family": {
                          "type": "string",
                          "x-llm": true,
                          "description": "llm: Generate realistic family name"
                        },
                        "given": {
                          "type": "array",
                          "items": {
                            "type": "string",
                            "x-llm": true,
                            "description": "llm: Generate realistic given names"
                          }
                        },
                        "prefix": {"type": "string"},
                        "suffix": {"type": "string"}
                      }
                    }
                  },
                  "administrativeGenderCode": {
                    "type": "object",
                    "properties": {
                      "code": {"type": "string", "enum": ["M", "F", "UN"]},
                      "codeSystem": {"type": "string", "const": "2.16.840.1.113883.5.1"},
                      "displayName": {"type": "string", "enum": ["Male", "Female", "Undifferentiated"]}
                    }
                  },
                  "birthTime": {
                    "type": "object",
                    "properties": {
                      "value": {
                        "type": "string",
                        "pattern": "^\\d{8}$"
                      }
                    }
                  },
                  "maritalStatusCode": {
                    "type": "object",
                    "properties": {
                      "code": {"type": "string", "enum": ["A", "D", "I", "L", "M", "P", "S", "T", "U", "W"]},
                      "codeSystem": {"type": "string", "const": "2.16.840.1.113883.5.2"},
                      "displayName": {"type": "string"}
                    }
                  },
                  "raceCode": {
                    "type": "object",
                    "properties": {
                      "code": {"type": "string"},
                      "codeSystem": {"type": "string", "const": "2.16.840.1.113883.6.238"},
                      "displayName": {"type": "string"}
                    }
                  },
                  "ethnicGroupCode": {
                    "type": "object",
                    "properties": {
                      "code": {"type": "string"},
                      "codeSystem": {"type": "string", "const": "2.16.840.1.113883.6.238"},
                      "displayName": {"type": "string"}
                    }
                  },
                  "languageCommunication": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "languageCode": {
                          "type": "object",
                          "properties": {
                            "code": {"type": "string", "examples": ["en", "es", "fr", "de", "zh"]}
                          }
                        },
                        "preferenceInd": {
                          "type": "object",
                          "properties": {
                            "value": {"type": "boolean"}
                          }
                        }
                      }
                    }
                  }
                }
              },
              "providerOrganization": {
                "type": "object",
                "properties": {
                  "id": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "root": {"type": "string"},
                        "extension": {"type": "string"}
                      }
                    }
                  },
                  "name": {
                    "type": "string",
                    "x-llm": true,
                    "description": "llm: Generate realistic healthcare organization name"
                  },
                  "telecom": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "use": {"type": "string"},
                        "value": {"type": "string"}
                      }
                    }
                  },
                  "addr": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "streetAddressLine": {"type": "string"},
                        "city": {"type": "string"},
                        "state": {"type": "string"},
                        "postalCode": {"type": "string"}
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "author": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["time", "assignedAuthor"],
        "properties": {
          "time": {
            "type": "object",
            "properties": {
              "value": {
                "type": "string",
                "pattern": "^\\d{14}$"
              }
            }
          },
          "assignedAuthor": {
            "type": "object",
            "required": ["id"],
            "properties": {
              "id": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "root": {"type": "string"},
                    "extension": {
                      "type": "string",
                      "x-llm": true,
                      "description": "llm: Generate realistic provider NPI or identifier"
                    }
                  }
                }
              },
              "code": {
                "type": "object",
                "properties": {
                  "code": {"type": "string"},
                  "codeSystem": {"type": "string", "const": "2.16.840.1.113883.6.101"},
                  "displayName": {
                    "type": "string",
                    "x-llm": true,
                    "description": "llm: Generate realistic healthcare provider specialty"
                  }
                }
              },
              "addr": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "streetAddressLine": {"type": "string"},
                    "city": {"type": "string"},
                    "state": {"type": "string"},
                    "postalCode": {"type": "string"}
                  }
                }
              },
              "telecom": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "use": {"type": "string"},
                    "value": {"type": "string"}
                  }
                }
              },
              "assignedPerson": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "family": {
                          "type": "string",
                          "x-llm": true,
                          "description": "llm: Generate realistic provider family name"
                        },
                        "given": {
                          "type": "array",
                          "items": {
                            "type": "string",
                            "x-llm": true,
                            "description": "llm: Generate realistic provider given names"
                          }
                        },
                        "prefix": {"type": "string", "default": "Dr"},
                        "suffix": {"type": "string"}
                      }
                    }
                  }
                }
              },
              "representedOrganization": {
                "type": "object",
                "properties": {
                  "id": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "root": {"type": "string"},
                        "extension": {"type": "string"}
                      }
                    }
                  },
                  "name": {
                    "type": "string",
                    "x-llm": true,
                    "description": "llm: Generate realistic healthcare organization name"
                  }
                }
              }
            }
          }
        }
      }
    },
    "custodian": {
      "type": "object",
      "required": ["assignedCustodian"],
      "properties": {
        "assignedCustodian": {
          "type": "object",
          "required": ["representedCustodianOrganization"],
          "properties": {
            "representedCustodianOrganization": {
              "type": "object",
              "required": ["id", "name"],
              "properties": {
                "id": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "root": {"type": "string"},
                      "extension": {"type": "string"}
                    }
                  }
                },
                "name": {
                  "type": "string",
                  "x-llm": true,
                  "description": "llm: Generate realistic custodian organization name"
                },
                "telecom": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "use": {"type": "string"},
                      "value": {"type": "string"}
                    }
                  }
                },
                "addr": {
                  "type": "object",
                  "properties": {
                    "streetAddressLine": {"type": "string"},
                    "city": {"type": "string"},
                    "state": {"type": "string"},
                    "postalCode": {"type": "string"}
                  }
                }
              }
            }
          }
        }
      }
    },
    "component": {
      "type": "object",
      "required": ["structuredBody"],
      "properties": {
        "structuredBody": {
          "type": "object",
          "required": ["component"],
          "properties": {
            "component": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["section"],
                "properties": {
                  "section": {
                    "type": "object",
                    "required": ["templateId", "code", "title"],
                    "properties": {
                      "templateId": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "root": {
                              "type": "string",
                              "examples": [
                                "2.16.840.1.113883.10.20.22.2.6.1",
                                "2.16.840.1.113883.10.20.22.2.1.1",
                                "2.16.840.1.113883.10.20.22.2.5.1",
                                "2.16.840.1.113883.10.20.22.2.10",
                                "2.16.840.1.113883.10.20.22.2.7.1"
                              ]
                            }
                          }
                        }
                      },
                      "code": {
                        "type": "object",
                        "properties": {
                          "code": {
                            "type": "string",
                            "examples": ["10160-0", "8716-3", "48765-2", "29762-2", "10154-3"]
                          },
                          "codeSystem": {"type": "string", "const": "2.16.840.1.113883.6.1"},
                          "displayName": {
                            "type": "string",
                            "x-llm": true,
                            "description": "llm: Generate appropriate section name based on code"
                          }
                        }
                      },
                      "title": {
                        "type": "string",
                        "x-llm": true,
                        "description": "llm: Generate section title matching the code"
                      },
                      "text": {
                        "type": "string",
                        "x-llm": true,
                        "description": "llm: Generate realistic clinical narrative text for the section"
                      },
                      "entry": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "observation": {
                              "type": "object",
                              "properties": {
                                "classCode": {"type": "string", "const": "OBS"},
                                "moodCode": {"type": "string", "const": "EVN"},
                                "templateId": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "root": {"type": "string"}
                                    }
                                  }
                                },
                                "id": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "root": {"type": "string", "format": "uuid"}
                                    }
                                  }
                                },
                                "code": {
                                  "type": "object",
                                  "properties": {
                                    "code": {"type": "string"},
                                    "codeSystem": {"type": "string"},
                                    "displayName": {
                                      "type": "string",
                                      "x-llm": true,
                                      "description": "llm: Generate observation name"
                                    }
                                  }
                                },
                                "statusCode": {
                                  "type": "object",
                                  "properties": {
                                    "code": {"type": "string", "enum": ["completed", "active", "aborted", "cancelled"]}
                                  }
                                },
                                "effectiveTime": {
                                  "type": "object",
                                  "properties": {
                                    "value": {
                                      "type": "string",
                                      "pattern": "^\\d{14}$"
                                    }
                                  }
                                },
                                "value": {
                                  "type": "object",
                                  "properties": {
                                    "xsi:type": {"type": "string"},
                                    "value": {
                                      "type": "string",
                                      "x-llm": true,
                                      "description": "llm: Generate appropriate observation value"
                                    },
                                    "unit": {"type": "string"},
                                    "code": {"type": "string"},
                                    "codeSystem": {"type": "string"},
                                    "displayName": {"type": "string"}
                                  }
                                }
                              }
                            },
                            "act": {
                              "type": "object",
                              "properties": {
                                "classCode": {"type": "string", "const": "ACT"},
                                "moodCode": {"type": "string", "const": "EVN"},
                                "templateId": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "root": {"type": "string"}
                                    }
                                  }
                                },
                                "id": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "root": {"type": "string", "format": "uuid"}
                                    }
                                  }
                                },
                                "code": {
                                  "type": "object",
                                  "properties": {
                                    "code": {"type": "string"},
                                    "codeSystem": {"type": "string"},
                                    "displayName": {
                                      "type": "string",
                                      "x-llm": true,
                                      "description": "llm: Generate act name"
                                    }
                                  }
                                },
                                "text": {
                                  "type": "string",
                                  "x-llm": true,
                                  "description": "llm: Generate act description"
                                },
                                "statusCode": {
                                  "type": "object",
                                  "properties": {
                                    "code": {"type": "string", "enum": ["completed", "active", "aborted", "cancelled"]}
                                  }
                                },
                                "effectiveTime": {
                                  "type": "object",
                                  "properties": {
                                    "value": {
                                      "type": "string",
                                      "pattern": "^\\d{14}$"
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
